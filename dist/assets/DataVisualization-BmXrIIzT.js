import{P as ge,B as ie,L as ye}from"./PieChart-BeRY37Tt.js";import{f as be}from"./request-YJDcd6Zt.js";import{p as j,q as W,g as C,i as _e,c as B,a as h,d as a,x as we,w as i,r as x,k as Q,y as xe,m as $,E as T,o as k,F as ee,f as ae,b as U,t as E,n as te,z as Se}from"./index-BC4_fVfx.js";import{a as oe}from"./index-t--hEgTQ.js";var N={exports:{}},Ae=N.exports,ue;function Ce(){return ue||(ue=1,function(A,g){(function(D,c){c()})(Ae,function(){function D(n,r){return typeof r>"u"?r={autoBom:!1}:typeof r!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),r={autoBom:!r}),r.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function c(n,r,w){var s=new XMLHttpRequest;s.open("GET",n),s.responseType="blob",s.onload=function(){y(s.response,r,w)},s.onerror=function(){console.error("could not download file")},s.send()}function R(n){var r=new XMLHttpRequest;r.open("HEAD",n,!1);try{r.send()}catch{}return 200<=r.status&&299>=r.status}function _(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(r)}}var S=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof j=="object"&&j.global===j?j:void 0,V=S.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),y=S.saveAs||(typeof window!="object"||window!==S?function(){}:"download"in HTMLAnchorElement.prototype&&!V?function(n,r,w){var s=S.URL||S.webkitURL,u=document.createElement("a");r=r||n.name||"download",u.download=r,u.rel="noopener",typeof n=="string"?(u.href=n,u.origin===location.origin?_(u):R(u.href)?c(n,r,w):_(u,u.target="_blank")):(u.href=s.createObjectURL(n),setTimeout(function(){s.revokeObjectURL(u.href)},4e4),setTimeout(function(){_(u)},0))}:"msSaveOrOpenBlob"in navigator?function(n,r,w){if(r=r||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(D(n,w),r);else if(R(n))c(n,r,w);else{var s=document.createElement("a");s.href=n,s.target="_blank",setTimeout(function(){_(s)})}}:function(n,r,w,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),typeof n=="string")return c(n,r,w);var u=n.type==="application/octet-stream",q=/constructor/i.test(S.HTMLElement)||S.safari,z=/CriOS\/[\d]+/.test(navigator.userAgent);if((z||u&&q||V)&&typeof FileReader<"u"){var I=new FileReader;I.onloadend=function(){var F=I.result;F=z?F:F.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=F:location=F,s=null},I.readAsDataURL(n)}else{var Y=S.URL||S.webkitURL,M=Y.createObjectURL(n);s?s.location=M:location.href=M,s=null,setTimeout(function(){Y.revokeObjectURL(M)},4e4)}});S.saveAs=y.saveAs=y,A.exports=y})}(N)),N.exports}Ce();const ne="CrUTqGhD5tukrSDrpk8ATDXSwbFl08nh",le="https://financialmodelingprep.com/api/v3";async function De(A,g="annual",D=5){try{return(await oe.get(`${le}/income-statement/${A}`,{params:{period:g,limit:D,apikey:ne}})).data}catch(c){throw console.error(`获取${A}收入报表失败:`,c),c}}async function Pe(A,g="annual",D=5){try{return(await oe.get(`${le}/balance-sheet-statement/${A}`,{params:{period:g,limit:D,apikey:ne}})).data}catch(c){throw console.error(`获取${A}资产负债表失败:`,c),c}}async function Fe(A,g="annual",D=5){try{return(await oe.get(`${le}/ratios/${A}`,{params:{period:g,limit:D,apikey:ne}})).data}catch(c){throw console.error(`获取${A}财务比率失败:`,c),c}}const ke={class:"data-visualization"},Me={class:"page-header"},Ee={class:"filter-container"},Re={class:"chart-card"},Le={class:"chart-header"},Te={class:"chart-controls"},Ie={class:"chart-card"},Oe={class:"chart-card"},Be={class:"data-table-container mt-20"},Ue={class:"pagination-container"},Ve={class:"chart-card"},ze={key:0,class:"data-table-container mt-20"},qe={__name:"DataVisualization",setup(A){const g=W({category:"",dateRange:[],company:"AAPL"}),D=[{value:"AAPL",label:"Apple Inc. (苹果)"},{value:"MSFT",label:"Microsoft Corporation (微软)"},{value:"GOOGL",label:"Alphabet Inc. (谷歌)"},{value:"AMZN",label:"Amazon.com Inc. (亚马逊)"},{value:"META",label:"Meta Platforms Inc. (Meta)"},{value:"TSLA",label:"Tesla Inc. (特斯拉)"},{value:"NVDA",label:"NVIDIA Corporation (英伟达)"},{value:"JPM",label:"JPMorgan Chase & Co. (摩根大通)"}],c=C(""),R=C([]),_=C({}),S=()=>{c.value="",M()},V=[{value:"收入",label:"收入"},{value:"支出",label:"支出"},{value:"投资",label:"投资"},{value:"储蓄",label:"储蓄"}],y=W({summary:!1,monthly:!1,trend:!1,table:!1}),n=C([]),r=C({xAxis:[],series:[]}),w=C({xAxis:[],series:[]}),s=C([]),u=W({currentPage:1,pageSize:10,total:0}),q=t=>{u.pageSize=t,G()},z=t=>{u.currentPage=t,G()},I=()=>{M()},Y=async()=>{try{await Se.confirm("这将清空现有数据并生成新的示例数据，确定继续吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await be.generateSampleData();T.success(t.message||"示例数据生成成功"),M()}catch(t){t!=="cancel"&&(console.error("生成示例数据失败",t),T.error("生成示例数据失败"))}},M=()=>{pe(),de(),G(),me()},F=()=>{if(c.value&&_.value[c.value])n.value=_.value[c.value],console.log("更新饼图数据:",c.value,n.value);else if(Object.keys(_.value).length>0){const t=Object.keys(_.value).pop();c.value=t,n.value=_.value[t],console.log("使用最新年份更新饼图:",t,n.value)}},pe=async()=>{y.monthly=!0,y.summary=!0;try{const t=g.company,e=await De(t,"annual",5);if(e&&e.length>0){const o=e.map(d=>new Date(d.date).getFullYear().toString()).reverse();R.value=o,!c.value&&o.length>0&&(c.value=o[o.length-1]);const m=e.map(d=>d.revenue/1e6).reverse(),f=e.map(d=>d.costOfRevenue/1e6).reverse(),p=e.map(d=>d.grossProfit/1e6).reverse(),b=e.map(d=>d.netIncome/1e6).reverse();r.value={xAxis:o,series:[{name:"营业收入",data:m},{name:"营业成本",data:f},{name:"毛利润",data:p},{name:"净利润",data:b}]},_.value={},o.forEach((d,P)=>{_.value[d]=[{name:"营业收入",value:m[P]},{name:"营业成本",value:f[P]},{name:"毛利润",value:p[P]},{name:"净利润",value:b[P]}]}),F(),console.info("使用FMP API获取的收入报表数据")}else throw new Error("未获取到收入报表数据")}catch(t){console.error("获取月度数据失败",t),T.error("获取月度数据失败，使用模拟数据");const e=["2020","2021","2022","2023","2024"];R.value=e,c.value||(c.value="2024");const o=[8e3,9200,9500,10700,12e3],m=[5e3,5500,5700,6e3,6500],f=[3e3,3700,3800,4700,5500],p=[2e3,2500,2600,3200,3800];r.value={xAxis:e,series:[{name:"营业收入",data:o},{name:"营业成本",data:m},{name:"毛利润",data:f},{name:"净利润",data:p}]},_.value={},e.forEach((b,d)=>{_.value[b]=[{name:"营业收入",value:o[d]},{name:"营业成本",value:m[d]},{name:"毛利润",value:f[d]},{name:"净利润",value:p[d]}]}),F()}finally{y.monthly=!1,y.summary=!1}},de=async()=>{y.trend=!0;try{const t=g.company,e=await Fe(t,"annual",5);if(e&&e.length>0){const o=e.map(b=>new Date(b.date).getFullYear().toString()).reverse(),m=e.map(b=>b.priceEarningsRatio||0).reverse(),f=e.map(b=>b.priceToBookRatio||0).reverse(),p=e.map(b=>b.returnOnEquity*100||0).reverse();w.value={xAxis:o,series:[{name:"市盈率(PE)",type:"line",smooth:!0,data:m},{name:"市净率(PB)",type:"line",smooth:!0,data:f},{name:"股本回报率(ROE)%",type:"line",smooth:!0,data:p}]},console.info("使用FMP API获取的财务比率数据")}else throw new Error("未获取到财务比率数据")}catch(t){console.error("获取趋势数据失败",t),T.error("获取趋势数据失败，使用模拟数据");const e=[],o=[],m=new Date;for(let f=11;f>=0;f--){const p=new Date(m.getFullYear(),m.getMonth()-f,1);e.push(p.toISOString().slice(0,10)),o.push(Math.floor(Math.random()*100)+150)}w.value={xAxis:e,series:[{name:"股价趋势(模拟)",type:"line",smooth:!0,data:o}]}}finally{y.trend=!1}},G=async()=>{y.table=!0;try{const t=g.company,e=await Pe(t,"annual",5);if(e&&e.length>0){const o=[];e.forEach(p=>{const d=new Date(p.date).getFullYear().toString();o.push({date:p.date,category:"总资产",value:p.totalAssets,description:`${d}年总资产`}),o.push({date:p.date,category:"总负债",value:p.totalLiabilities,description:`${d}年总负债`}),o.push({date:p.date,category:"股东权益",value:p.totalStockholdersEquity,description:`${d}年股东权益`}),o.push({date:p.date,category:"现金及等价物",value:p.cashAndCashEquivalents,description:`${d}年现金及等价物`})}),s.value=o.map(p=>({...p,value:Number(p.value)})),u.total=s.value.length;const m=(u.currentPage-1)*u.pageSize,f=m+u.pageSize;s.value=s.value.slice(m,f),console.info("使用FMP API获取的资产负债表数据");return}else throw new Error("未获取到资产负债表数据")}catch(t){console.error("获取表格数据失败",t),T.error("获取表格数据失败，使用模拟数据");const e=[{date:"2025-01-15",category:"收入",value:8500,description:"工资收入"},{date:"2025-01-20",category:"支出",value:2e3,description:"房租"},{date:"2025-02-01",category:"投资",value:3e3,description:"股票投资"},{date:"2025-02-15",category:"收入",value:9e3,description:"工资收入"},{date:"2025-02-25",category:"支出",value:1500,description:"生活用品"}];s.value=e,u.total=e.length}finally{y.table=!1}},L=C([]),O=C(!1),H=C({xAxis:[],series:[]}),X=C([]),me=async()=>{O.value=!0;try{const e=await(await fetch("http://127.0.0.1:8000/api/stocks/quotes")).json();if(e.data&&e.data.length>0)L.value=e.data.map(o=>({symbol:o.symbol,name:o.name,price:o.price,change:(o.price*o.change_percent/100).toFixed(2),changePercent:o.change_percent.toFixed(2)+"%",marketCap:re(o.market_cap),peRatio:o.pe_ratio.toFixed(2),volume:o.volume,currency:o.currency})),X.value=e.data.map(o=>({symbol:o.symbol,name:o.name,pe:o.pe_ratio.toFixed(2),marketCap:re(o.market_cap),volume:o.volume.toLocaleString(),price:o.price.toFixed(2),changePercent:o.change_percent.toFixed(2)+"%"})),se(L.value),console.info("使用本地API获取的股票数据",L.value);else throw new Error("未获取到股票数据")}catch(t){console.error("获取股票数据失败",t),T.error("获取股票数据失败，使用模拟数据"),ve()}finally{O.value=!1}},re=t=>t?t>=1e12?(t/1e12).toFixed(2)+"万亿":t>=1e9?(t/1e9).toFixed(2)+"十亿":t>=1e6?(t/1e6).toFixed(2)+"百万":t.toLocaleString():"N/A",se=t=>{const e=t.map(m=>m.symbol),o=t.map(m=>m.price);t.map(m=>parseFloat(m.changePercent)),H.value={xAxis:e,series:[{name:"当前价格($)",data:o,type:"bar"}]},console.log("股票图表数据:",H.value)},ve=()=>{const t=[{symbol:"AAPL",name:"Apple Inc.",price:202.09,changePercent:"-2.31%",marketCap:"3.02万亿",peRatio:"31.53",volume:58857268,currency:"USD"},{symbol:"MSFT",name:"Microsoft Corporation",price:452.57,changePercent:"-1.22%",marketCap:"3.36万亿",peRatio:"35.03",volume:18399615,currency:"USD"},{symbol:"GOOGL",name:"Alphabet Inc.",price:178.35,changePercent:"0.85%",marketCap:"2.21万亿",peRatio:"27.12",volume:22563214,currency:"USD"},{symbol:"AMZN",name:"Amazon.com Inc.",price:185.67,changePercent:"-0.45%",marketCap:"1.92万亿",peRatio:"42.78",volume:31256987,currency:"USD"},{symbol:"META",name:"Meta Platforms Inc.",price:512.45,changePercent:"1.23%",marketCap:"1.31万亿",peRatio:"29.45",volume:15698745,currency:"USD"}];L.value=t,X.value=t.map(e=>({symbol:e.symbol,name:e.name,pe:e.peRatio,marketCap:e.marketCap,volume:parseInt(e.volume).toLocaleString(),price:e.price.toFixed(2),changePercent:e.changePercent})),se(t)};return _e(()=>{M()}),(t,e)=>{const o=x("el-option"),m=x("el-select"),f=x("el-form-item"),p=x("el-date-picker"),b=x("el-button"),d=x("el-form"),P=x("el-col"),J=x("el-row"),v=x("el-table-column"),K=x("el-table"),he=x("el-pagination"),ce=x("el-tab-pane"),fe=x("el-tabs"),Z=xe("loading");return k(),B("div",ke,[h("div",Me,[e[6]||(e[6]=h("h1",{class:"page-title"},"财务数据可视化",-1)),h("div",Ee,[a(d,{inline:!0,model:g,class:"filter-form"},{default:i(()=>[a(f,{label:"类别"},{default:i(()=>[a(m,{modelValue:g.category,"onUpdate:modelValue":e[0]||(e[0]=l=>g.category=l),placeholder:"选择类别",clearable:""},{default:i(()=>[(k(),B(ee,null,ae(V,l=>a(o,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"时间范围"},{default:i(()=>[a(p,{modelValue:g.dateRange,"onUpdate:modelValue":e[1]||(e[1]=l=>g.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(f,{label:"公司"},{default:i(()=>[a(m,{modelValue:g.company,"onUpdate:modelValue":e[2]||(e[2]=l=>g.company=l),placeholder:"选择公司",onChange:S,style:{width:"280px"},"popper-class":"company-select-dropdown"},{default:i(()=>[(k(),B(ee,null,ae(D,l=>a(o,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(f,null,{default:i(()=>[a(b,{type:"primary",onClick:I},{default:i(()=>e[4]||(e[4]=[U("筛选")])),_:1}),a(b,{type:"success",onClick:Y},{default:i(()=>e[5]||(e[5]=[U("生成示例数据")])),_:1})]),_:1})]),_:1},8,["model"])])]),a(J,{gutter:20},{default:i(()=>[a(P,{xs:24,sm:24,md:12,lg:12,xl:12},{default:i(()=>[h("div",Re,[h("div",Le,[e[8]||(e[8]=h("h3",{class:"chart-title"},"财务数据类别分布",-1)),h("div",Te,[e[7]||(e[7]=h("span",{class:"control-label"},"选择年份:",-1)),a(m,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=l=>c.value=l),placeholder:"选择年份",size:"small",onChange:F,style:{"min-width":"120px"}},{default:i(()=>[(k(!0),B(ee,null,ae(R.value,l=>(k(),$(o,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(ge,{"chart-data":n.value,loading:y.summary,height:"350px",title:"","show-title":!1},null,8,["chart-data","loading"])])]),_:1}),a(P,{xs:24,sm:24,md:12,lg:12,xl:12},{default:i(()=>[h("div",Ie,[a(ie,{"chart-data":r.value,title:"年度财务数据对比",loading:y.monthly,height:"350px"},null,8,["chart-data","loading"])])]),_:1})]),_:1}),a(J,{gutter:20,class:"mt-20"},{default:i(()=>[a(P,{span:24},{default:i(()=>[h("div",Oe,[a(ye,{"chart-data":w.value,title:"财务数据时间趋势",loading:y.trend,height:"400px"},null,8,["chart-data","loading"])])]),_:1})]),_:1}),h("div",Be,[e[9]||(e[9]=h("h2",{class:"section-title"},"详细数据",-1)),Q((k(),$(K,{data:s.value,style:{width:"100%"},border:"",stripe:""},{default:i(()=>[a(v,{prop:"date",label:"日期",sortable:""}),a(v,{prop:"category",label:"类别",sortable:""}),a(v,{prop:"value",label:"金额",sortable:""},{default:i(l=>[U(E(l.row.value.toLocaleString("zh-CN",{style:"currency",currency:"CNY"})),1)]),_:1}),a(v,{prop:"description",label:"描述"})]),_:1},8,["data"])),[[Z,y.table]]),h("div",Ue,[a(he,{"current-page":u.currentPage,"page-sizes":[10,20,50,100],"page-size":u.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:u.total,onSizeChange:q,onCurrentChange:z},null,8,["current-page","page-size","total"])])]),a(J,{gutter:20,class:"mt-20"},{default:i(()=>[a(P,{span:24},{default:i(()=>[h("div",Ve,[e[10]||(e[10]=h("h2",{class:"section-title"},"股票行情数据",-1)),a(ie,{"chart-data":H.value,title:"主要股票价格与涨跌幅对比",loading:O.value,height:"450px"},null,8,["chart-data","loading"])])]),_:1})]),_:1}),L.value.length>0?(k(),B("div",ze,[e[11]||(e[11]=h("h2",{class:"section-title"},"股票详细数据",-1)),a(fe,{type:"border-card",class:"stock-tabs"},{default:i(()=>[a(ce,{label:"价格与交易信息"},{default:i(()=>[Q((k(),$(K,{data:L.value,style:{width:"100%"},border:"",stripe:""},{default:i(()=>[a(v,{prop:"symbol",label:"代码",width:"80",fixed:""}),a(v,{prop:"name",label:"名称",width:"180",fixed:""}),a(v,{prop:"price",label:"当前价格",width:"100"},{default:i(l=>[U(E(l.row.price.toFixed(2))+" "+E(l.row.currency),1)]),_:1}),a(v,{prop:"change",label:"涨跌额",width:"100"},{default:i(l=>[h("span",{class:te(parseFloat(l.row.change)>0?"text-success":"text-danger")},E(l.row.change),3)]),_:1}),a(v,{prop:"changePercent",label:"涨跌幅",width:"100"},{default:i(l=>[h("span",{class:te(parseFloat(l.row.changePercent)>0?"text-success":"text-danger")},E(l.row.changePercent),3)]),_:1}),a(v,{prop:"marketCap",label:"市值",width:"120"}),a(v,{prop:"peRatio",label:"市盈率",width:"100"}),a(v,{prop:"volume",label:"成交量",width:"120"},{default:i(l=>[U(E(l.row.volume.toLocaleString()),1)]),_:1})]),_:1},8,["data"])),[[Z,O.value]])]),_:1}),a(ce,{label:"财务指标"},{default:i(()=>[Q((k(),$(K,{data:X.value,style:{width:"100%"},border:"",stripe:""},{default:i(()=>[a(v,{prop:"symbol",label:"代码",width:"80",fixed:""}),a(v,{prop:"name",label:"名称",width:"180",fixed:""}),a(v,{prop:"price",label:"价格",width:"100"}),a(v,{prop:"changePercent",label:"涨跌幅",width:"100"},{default:i(l=>[h("span",{class:te(parseFloat(l.row.changePercent)>0?"text-success":"text-danger")},E(l.row.changePercent),3)]),_:1}),a(v,{prop:"pe",label:"市盈率(TTM)",width:"120"}),a(v,{prop:"marketCap",label:"市值",width:"120"}),a(v,{prop:"volume",label:"成交量",width:"120"})]),_:1},8,["data"])),[[Z,O.value]])]),_:1})]),_:1})])):we("",!0)])}}};export{qe as default};
